<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dear Miracle</title>

  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Tahoma, Verdana, Arial, sans-serif;
      overflow: hidden;
      background: #000;
    }

    :root{
      --titlebar-top: #f7f7f7;
      --titlebar-bot: #e9e9e9;

      --frame: rgba(255,255,255,0.60);
      --glass: rgba(255,255,255,0.40);
      --border: rgba(0,0,0,0.30);

      --shadow: 0 12px 30px rgba(0,0,0,0.22);
      --shadow-strong: 0 18px 46px rgba(0,0,0,0.30);

      --text: #1b1b1b;
      --muted: rgba(0,0,0,0.55);
    }

    .wallpaper {
      position: fixed;
      inset: 0;
      background-image: url("bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: saturate(0.95) contrast(0.98);
      transform: scale(1.02);
    }

    .wallpaper::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(1200px 600px at 20% 15%, rgba(255,255,255,0.30), transparent 60%),
        radial-gradient(900px 500px at 80% 25%, rgba(255,255,255,0.22), transparent 55%),
        radial-gradient(900px 700px at 55% 80%, rgba(255,255,255,0.18), transparent 60%),
        linear-gradient(to bottom, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      pointer-events:none;
    }

    .desk {
      position: fixed;
      inset: 0;
      pointer-events: none;
    }

    .win {
      position: absolute;
      width: 420px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      background: var(--frame);

      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);

      pointer-events: auto;
      user-select: none;
    }
    .win.is-front { box-shadow: var(--shadow-strong); }

    .titlebar {
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 8px 0 10px;

      background: linear-gradient(to bottom, var(--titlebar-top), var(--titlebar-bot));
      border-bottom: 1px solid rgba(0,0,0,0.18);

      color: #222;
      text-shadow: none;
      cursor: grab;
    }
    .titlebar:active { cursor: grabbing; }

    .title-left {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 2px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.75);
      flex: 0 0 auto;
    }

    .title {
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 280px;
    }

    .title-btns {
      display: flex;
      gap: 6px;
      flex: 0 0 auto;
    }

    .btn {
      width: 16px;
      height: 16px;
      border-radius: 2px;
      border: 1px solid rgba(0,0,0,0.35);
      background: rgba(255,255,255,0.85);
      box-shadow: inset 0 -1px 0 rgba(0,0,0,0.12);
    }

    .content {
      background: var(--glass);
      padding: 8px;
    }

    .media {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.18);
      background: rgba(255,255,255,0.35);
    }
    .media img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
    }

    .meta {
      margin-top: 6px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      padding: 4px 6px;
      border-radius: 6px;
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(0,0,0,0.12);
    }

    .note {
      padding: 10px 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.14);
      background: rgba(255,255,255,0.62);
      color: #222;
      font-size: 13px;
      line-height: 1.35;
    }
    .note b { display:block; margin-bottom: 6px; }
    .note ul { margin: 8px 0 0 18px; padding:0; }
    .note li { margin: 3px 0; }
    .note a { color:#0b57d0; text-decoration: underline; }

    .taskbar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 44px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 12px;

      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);

      border-top: 1px solid rgba(0,0,0,0.18);
    }

    .start {
      height: 30px;
      padding: 0 12px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.80);
      font-weight: 700;
      font-size: 12px;
      display:flex;
      align-items:center;
      gap: 8px;
      cursor: pointer;
    }

    .brand {
      font-size: 13px;
      color: #222;
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .spacer { flex: 1; }
    .clock {
      font-size: 12px;
      color: rgba(0,0,0,0.65);
      font-variant-numeric: tabular-nums;
    }

    @media (max-width: 480px){
      .win { width: 340px; }
      .title { max-width: 220px; }
    }

    /* ===== YouTube playlist window ===== */
    .yt-window { width: 280px; }
    .yt-window .content { padding: 0; background: #fff; }
    .yt-window iframe {
      width: 100%;
      height: 190px;
      border: 0;
      display: block;
    }
    .yt-window .titlebar .buttons {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .yt-window .sound-btn {
      font-size: 12px;
      padding: 2px 8px;
      border: 1px solid rgba(0,0,0,0.25);
      border-radius: 6px;
      background: rgba(255,255,255,0.85);
      cursor: pointer;
    }
    .yt-window .sound-btn:active { transform: translateY(1px); }

    /* =========================================================
       âœ… ì¹´í†¡ì‹ ìª½ì§€: FAB + ì•ˆì½ìŒ ë±ƒì§€ + ëŒ€í™”ë°©ëª©ë¡/ëŒ€í™”ì°½ ëª¨ë‹¬
       ========================================================= */
    .dm-fab{
      position: fixed;
      right: 18px;
      bottom: 64px;
      z-index: 99999;
      pointer-events: auto;
    }
    .dm-fab button{
      width: 64px;
      height: 64px;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.78);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 14px 40px rgba(0,0,0,0.25);
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 28px;
      line-height: 1;
    }
    .dm-fab button:active{ transform: translateY(1px); }

    .dm-badge{
      position: absolute;
      top: -6px;
      right: -6px;
      min-width: 26px;
      height: 26px;
      padding: 0 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 13px;
      display:none;
      align-items:center;
      justify-content:center;
    }

    @media (max-width: 560px){
      .dm-fab{ right: 14px; bottom: 66px; }
      .dm-fab button{
        width: 78px;
        height: 78px;
        border-radius: 22px;
        font-size: 34px;
      }
      .dm-badge{
        min-width: 30px;
        height: 30px;
        font-size: 14px;
      }
    }

    .dm-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 99998;
      pointer-events: auto;
    }
    .dm-modal{
      width: min(920px, 100%);
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(0,0,0,0.18);
      border-radius: 12px;
      overflow:hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .dm-modal .titlebar{ cursor: default; }
    .dm-modal .content{ background: transparent; padding: 0; }

    .dm-head{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
      padding: 10px;
      background: rgba(255,255,255,0.55);
      border-bottom: 1px solid rgba(0,0,0,0.12);
    }
    .dm-tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .dm-pill{
      height: 36px;
      padding: 0 12px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 13px;
      cursor: pointer;
    }
    .dm-pill.ghost{ background: rgba(255,255,255,0.65); }
    .dm-pill:active{ transform: translateY(1px); }

    .dm-body{
      padding: 10px;
    }

    /* ====== ì¹´í†¡ì‹ ë ˆì´ì•„ì›ƒ ====== */
    .dm-split{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 10px;
    }
    @media (max-width: 860px){
      .dm-split{ grid-template-columns: 1fr; }
    }

    .panel{
      background: rgba(255,255,255,0.62);
      border: 1px solid rgba(0,0,0,0.14);
      border-radius: 12px;
      overflow:hidden;
    }
    .panel .ph{
      padding: 10px 12px;
      font-weight: 900;
      font-size: 13px;
      color: rgba(0,0,0,0.70);
      background: rgba(255,255,255,0.55);
      border-bottom: 1px solid rgba(0,0,0,0.12);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 8px;
    }

    .rooms{
      max-height: min(62vh, 560px);
      overflow:auto;
    }
    .room{
      padding: 10px 12px;
      border-top: 1px solid rgba(0,0,0,0.08);
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 10px;
    }
    .room:hover{ background: rgba(255,255,255,0.55); }
    .room .name{
      font-weight: 900;
      font-size: 14px;
      color:#222;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 220px;
    }
    .room .last{
      font-size: 12px;
      color: rgba(0,0,0,0.60);
      margin-top: 4px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 220px;
    }
    .room .right{
      display:flex;
      flex-direction: column;
      align-items:flex-end;
      gap: 6px;
      flex: 0 0 auto;
    }
    .room .time{
      font-size: 11px;
      color: rgba(0,0,0,0.55);
      font-variant-numeric: tabular-nums;
    }
    .room .unread{
      min-width: 22px;
      height: 22px;
      padding: 0 7px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.18);
      background: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 12px;
      display:none;
      align-items:center;
      justify-content:center;
    }

    .chat{
      display:flex;
      flex-direction: column;
      height: min(62vh, 560px);
    }
    .chat-list{
      flex: 1;
      overflow:auto;
      padding: 12px;
      display:flex;
      flex-direction: column;
      gap: 8px;
    }
    .chat-row{ display:flex; }
    .bubble{
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.14);
      background: rgba(255,255,255,0.70);
      color:#222;
      font-size: 14px;
      line-height: 1.45;
      white-space: pre-wrap;
      position: relative;
    }
    .bubble.me{
      margin-left: auto;
      background: rgba(255,255,255,0.92);
    }
    .bubble .t{
      margin-top: 6px;
      font-size: 11px;
      color: rgba(0,0,0,0.55);
      font-variant-numeric: tabular-nums;
    }

    .chat-send{
      padding: 10px;
      border-top: 1px solid rgba(0,0,0,0.12);
      display:flex;
      gap: 8px;
      align-items: flex-end;
      background: rgba(255,255,255,0.55);
    }
    .chat-send textarea{
      flex: 1;
      min-height: 44px;
      max-height: 160px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.18);
      background: rgba(255,255,255,0.90);
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      line-height: 1.45;
    }

    .dm-hint{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(0,0,0,0.60);
      line-height: 1.35;
      min-height: 18px;
    }
    /* ìš°ì¸¡ í•˜ë‹¨ ë©”ì‹ ì € ë²„íŠ¼: ì¿ë¹› ê²€ì •ìœ¼ë¡œ ê°€ì‹œì„± ì—… */
.dm-fab button{
  background: rgba(25,25,28,0.88) !important;
  border: 1px solid rgba(255,255,255,0.18) !important;
  box-shadow: 0 16px 46px rgba(0,0,0,0.45) !important;
  color: rgba(255,255,255,0.92) !important;
}

.dm-fab button:hover{
  background: rgba(35,35,40,0.92) !important;
}

.dm-fab button:active{
  transform: translateY(1px);
}

/* ë±ƒì§€ë„ ì–´ë‘ìš´ ë²„íŠ¼ ìœ„ì—ì„œ ì˜ ë³´ì´ê²Œ */
.dm-badge{
  background: rgba(255,255,255,0.95) !important;
  color: rgba(0,0,0,0.85) !important;
  border: 1px solid rgba(0,0,0,0.25) !important;
}
/* ì™¼ìª½ ì•ˆë‚´ì°½ ì•ˆì˜ ë©”ì‹ ì € ì•ˆë‚´ë¬¸ */
.dm-guide{
  margin-top: 10px;
  padding: 10px 10px;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,0.14);
  background: rgba(255,255,255,0.72);
  font-size: 13px;
  line-height: 1.35;
  color: rgba(0,0,0,0.75);
}
.dm-guide b{
  font-weight: 900;
  color: rgba(0,0,0,0.88);
}

  </style>
</head>

<body>
  <div class="wallpaper"></div>

  <div class="desk" id="desk">

    <!-- 0) ê³µì§€/ê²Œì‹œíŒ ì•ˆë‚´ ì°½ -->
    <div class="win is-front" data-key="notice" style="left:18px; top:18px; width: 260px;" data-z="50">
      <div class="titlebar">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title">êµ¬ì¸ ê²Œì‹œíŒ</div>
        </div>
        <div class="title-btns">
          <div class="btn"></div><div class="btn"></div><div class="btn"></div>
        </div>
      </div>
      <div class="content">
        <div class="note">
          <b>Dear Miracle</b>
          ê°€ê°œì¥ ê¸°ê°„ ë™ì•ˆë§Œ ìš´ì˜í•©ë‹ˆë‹¤.
          <ul>
            <li>êµ¬ì¸ê²Œì‹œíŒ: ì „ì²´ ê³µê°œ (ë³¸ì¸ ë‹‰ë„¤ì„ë§Œ í™•ì¸í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.) </li>
            <li>ì™„ë£Œ ì‹œ ê²Œì‹œê¸€ ë°‘ì— ê´€ê³„ í•œ ì¤„ ìš”ì•½ ê¸°ì¬</li>
          </ul>
          <div class="dm-guide">
  ğŸ“© ì»¨íƒ/ìª½ì§€ëŠ” <b>ìš°ì¸¡ í•˜ë‹¨ ë©”ì‹ ì €</b>ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.
</div>
          <div style="margin-top:10px;">
            <a href="board.html">ê²Œì‹œíŒ ë“¤ì–´ê°€ê¸°</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ“© ë©”ì‹ ì € ì•ˆë‚´ -->
<div class="win" data-key="dm-notice"
     style="left:920px; top:520px; width:260px;" data-z="18">

  <div class="titlebar">
    <div class="title-left">
      <div class="dot"></div>
      <div class="title">ë©”ì‹ ì €</div>
    </div>
    <div class="title-btns">
      <div class="btn"></div><div class="btn"></div><div class="btn"></div>
    </div>
  </div>

  <div class="content">
    <div class="note">
      <b>ì»¨íƒ / ìª½ì§€</b>
      ì˜¤ë¥¸ìª½ í•˜ë‹¨ ë©”ì‹ ì €ë¥¼<br>
      ì´ìš©í•´ì£¼ì„¸ìš”.

      <div style="margin-top:12px;">
        <button
          onclick="document.getElementById('dmFabBtn').click()"
          style="
            width:100%;
            padding:10px;
            border-radius:8px;
            border:1px solid rgba(0,0,0,0.25);
            background:rgba(0,0,0,0.75);
            color:#fff;
            font-weight:700;
            cursor:pointer;
          ">
          ë©”ì‹ ì € ì—´ê¸°
        </button>
      </div>
    </div>
  </div>
</div>

    <!-- 1 -->
    <div class="win" data-key="w1" style="left:270px; top:70px;" data-z="10">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_002.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img01.jpg" alt=""></div>
        <div class="meta"><span>Preview Â· File Â· Edit Â· View</span><span>â€”</span></div>
      </div>
    </div>

    <!-- 2 -->
    <div class="win" data-key="w2" style="left:510px; top:92px; width: 360px;" data-z="11">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_006.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img02.jpg" alt=""></div>
        <div class="meta"><span>00:17</span><span> </span></div>
      </div>
    </div>

    <!-- 3 -->
<div class="win" data-key="w3" style="left:260px; top:290px; width: 520px;" data-z="12">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_003.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img03.jpg" alt=""></div>
        <div class="meta"><span>â–¶ 02:47</span><span> </span></div>
      </div>
    </div>

    <!-- 4 -->
    <div class="win" data-key="w4" style="left:40px; top:520px; width: 440px;" data-z="13">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_004.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img04.jpg" alt=""></div>
        <div class="meta"><span>Saved 1 min ago</span><span> </span></div>
      </div>
    </div>

    <!-- 5 -->
    <div class="win" data-key="w5" style="left:380px; top:520px; width: 520px;" data-z="14">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_005.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img05.jpg" alt=""></div>
        <div class="meta"><span>Continue listening?</span><span> </span></div>
      </div>
    </div>

    <!-- 6 -->
<div class="win" data-key="w6" style="left:680px; top:300px; width: 500px;" data-z="15">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_007.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img06.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- 7 -->
    <div class="win" data-key="w7" style="left:860px; top:70px; width: 260px;" data-z="16">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_008.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img07.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- 8 -->
    <div class="win" data-key="w8" style="left:880px; top:430px; width: 320px;" data-z="17">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_009.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img08.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- 8 -->
<div class="win" data-key="w8" style="left:1030px; top:470px; width: 320px;" data-z="17">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_010.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img09.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- ğŸµ YouTube Playlist Window -->
<div class="win yt-window" data-key="yt" id="ytWin" style="top:520px; left:520px;" data-z="9">
      <div class="titlebar" id="ytDrag">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title">0722_1029_011.mp4</div>
        </div>
        <div class="title-btns">
          <button class="sound-btn" id="ytSoundBtn">ğŸ”‡</button>
          <div class="btn"></div><div class="btn"></div><div class="btn"></div>
        </div>
      </div>

      <div class="content">
        <iframe
          id="ytFrame"
          src="https://www.youtube.com/embed/videoseries?list=PLUE3Cb-ZSnOeLPneQRPY76iI9h9NCQMp6&autoplay=1&loop=1&mute=1"
          allow="autoplay; encrypted-media"
          allowfullscreen>
        </iframe>
      </div>
    </div>

  </div>

  <!-- âœ… ìª½ì§€ ì•„ì´ì½˜ -->
  <div class="dm-fab">
    <button id="dmFabBtn" title="ìª½ì§€í•¨">âœ‰ï¸</button>
    <div class="dm-badge" id="dmBadge">0</div>
  </div>

  <!-- âœ… ì¹´í†¡ì‹ ë©”ì‹ ì € ëª¨ë‹¬ -->
  <div class="dm-backdrop" id="dmBg">
    <div class="dm-modal">
      <div class="titlebar" style="cursor:default;">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title" id="dmTitle">ë‚´ ìª½ì§€í•¨</div>
        </div>
        <div class="title-btns">
          <div class="btn" id="dmCloseBtn" title="ë‹«ê¸°"></div>
        </div>
      </div>

      <div class="dm-head">
        <div class="dm-tabs">
          <button class="dm-pill ghost" id="chatBackBtn" style="display:none;">â† ëª©ë¡</button>
          <button class="dm-pill" id="dmRefresh">ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <button class="dm-pill" id="dmNickBtn">ë‹‰ë„¤ì„</button>
      </div>

      <div class="dm-body">
        <div class="dm-split">

          <!-- ì™¼ìª½: ëŒ€í™”ë°© ëª©ë¡ -->
          <div class="panel" id="roomPanel">
            <div class="ph">
              <span>ëŒ€í™”</span>
              <span style="font-size:11px;color:rgba(0,0,0,0.55);" id="roomHint"></span>
            </div>
            <div class="rooms" id="roomList"></div>
          </div>

          <!-- ì˜¤ë¥¸ìª½: ëŒ€í™”ì°½ -->
          <div class="panel" id="chatPanel">
            <div class="ph">
              <span id="chatWith">ëŒ€í™”ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
              <span style="font-size:11px;color:rgba(0,0,0,0.55);" id="chatHintTop"></span>
            </div>

            <div class="chat">
              <div class="chat-list" id="chatList"></div>
              <div class="chat-send">
                <textarea id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥â€¦"></textarea>
                <button class="dm-pill" id="chatSend">ë³´ë‚´ê¸°</button>
              </div>
            </div>
          </div>

        </div>

        <div class="dm-hint" id="dmHint"></div>
      </div>
    </div>
  </div>

  <div class="taskbar">
    <div class="start" onclick="alert('Dear Miracle')">Start</div>
    <div class="brand">Dear Miracle</div>
    <div class="spacer"></div>
    <div class="clock" id="clock">--:--</div>
  </div>

  <!-- âœ… ë‹‰ë„¤ì„ ì…ë ¥(í‚¤ ê³µìœ : localStorage "dm_nick") -->
  <div class="dm-backdrop" id="nickBg" style="z-index: 100000; display:none;">
    <div class="dm-modal" style="width: min(520px, 100%);">
      <div class="titlebar" style="cursor: default;">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title">ë‹‰ë„¤ì„ ì…ë ¥</div>
        </div>
        <div class="title-btns">
          <div class="btn" id="nickClose" title="ë‹«ê¸°"></div>
        </div>
      </div>
      <div class="dm-body">
        <div style="display:block;">
          <div class="field" style="display:grid; gap:6px; margin-bottom:10px;">
            <div class="label" style="font-size:12px;color:rgba(0,0,0,0.65);font-weight:900;">ë‹‰ë„¤ì„</div>
            <input id="nickInput" placeholder="ì˜ˆ: DearMiracle / ã…‡ã…‡ / ë‹‰ë„¤ì„" maxlength="30"
              style="width:100%;border-radius:12px;border:1px solid rgba(0,0,0,0.18);background:rgba(255,255,255,0.90);padding:11px 12px;font-size:14px;outline:none;" />
          </div>
          <div class="dm-actions" style="display:flex; gap:8px; justify-content:flex-end;">
            <button class="dm-pill ghost" id="nickCancel">ì·¨ì†Œ</button>
            <button class="dm-pill" id="nickSave">í™•ì¸</button>
          </div>
        </div>
        <div class="dm-hint" id="nickHint"></div>
      </div>
    </div>
  </div>

  <script>
  // ===== ì°½ ë“œë˜ê·¸ + ì•ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸° + (ì²« ë¡œë”©) í™”ë©´ë³„ ìë™ ë°°ì¹˜ =====
  const wins = Array.from(document.querySelectorAll(".win"));
  let topZ = 100;
  let hasUserMoved = false;

  function bringToFront(win){
    topZ += 1;
    win.style.zIndex = topZ;
    wins.forEach(w => w.classList.remove("is-front"));
    win.classList.add("is-front");
  }

  function clamp(n, min, max){ return Math.min(Math.max(n, min), max); }

  function place(win, x01, y01){
    const taskbar = document.querySelector(".taskbar");
    const taskH = taskbar ? taskbar.offsetHeight : 44;

    const vw = window.innerWidth;
    const vh = window.innerHeight;

    const marginX = 18;
    const marginTop = 18;
    const marginBottom = taskH + 18;

    const w = win.offsetWidth;
    const h = win.offsetHeight;

    const usableW = vw - marginX*2 - w;
    const usableH = vh - marginTop - marginBottom - h;

    let left = marginX + (usableW * x01);
    let top  = marginTop + (usableH * y01);

    // í™”ë©´ ë°–ìœ¼ë¡œ ë„ˆë¬´ ë‚˜ê°€ì§€ ì•Šê²Œ
    const maxX = vw - 60;
    const maxY = vh - 120;
    left = clamp(left, -40, maxX);
    top  = clamp(top,  -20, maxY);

    win.style.left = left + "px";
    win.style.top  = top  + "px";
  }

  function autoLayout(){
    if(hasUserMoved) return;

    const byKey = {};
    wins.forEach(w => { byKey[w.dataset.key] = w; });

    const vw = window.innerWidth;

    // ===== PC (ì›ë˜ ë²„ì „) =====
    if(vw >= 1100){
  if(byKey.notice) place(byKey.notice, 0.02, 0.03);
  if(byKey.yt) place(byKey.yt, 0.05, 0.50);

      if(byKey.w1)     place(byKey.w1,     0.22, 0.12);
      if(byKey.w2)     place(byKey.w2,     0.50, 0.15);
      if(byKey.w3)     place(byKey.w3,     0.28, 0.42);

      if(byKey.w4)     place(byKey.w4,     0.05, 0.78);
      if(byKey.w5)     place(byKey.w5,     0.35, 0.80);

      if(byKey.w7)     place(byKey.w7,     0.78, 0.10);
      if(byKey.w6)     place(byKey.w6,     0.70, 0.45);
      if(byKey.w8)     place(byKey.w8,     0.80, 0.62);
      if(byKey.w10)    place(byKey.w10,    0.92, 0.75);
      if(byKey["dm-notice"]) place(byKey["dm-notice"], 0.92, 0.30);

      return;
    }

    // ===== íƒœë¸”ë¦¿ (ì›ë˜ ë²„ì „) =====
    if(vw >= 700){
      if(byKey.notice) place(byKey.notice, 0.03, 0.03);
      if(byKey.yt)     place(byKey.yt,     0.03, 0.55);

      if(byKey.w1)     place(byKey.w1,     0.45, 0.10);
      if(byKey.w2)     place(byKey.w2,     0.45, 0.35);
      if(byKey.w3)     place(byKey.w3,     0.20, 0.30);

      if(byKey.w4)     place(byKey.w4,     0.03, 0.78);
      if(byKey.w5)     place(byKey.w5,     0.45, 0.78);

      if(byKey.w6)     place(byKey.w6,     0.70, 0.50);
      if(byKey.w7)     place(byKey.w7,     0.70, 0.05);
      if(byKey.w8)     place(byKey.w8,     0.70, 0.70);

      if(byKey.w10)    place(byKey.w10,    0.45, 0.60);
      return;
    }

    // ===== ëª¨ë°”ì¼ (ì›ë˜ ë²„ì „) =====
    const order = ["notice","yt","w1","w2","w3","w4","w5","w6","w7","w8","w10","dm-notice"];
    let y = 0.03;
    order.forEach((k, i) => {
      const w = byKey[k];
      if(!w) return;
      place(w, (i % 2 ? 0.08 : 0.02), y);
      y += 0.07;
    });
  }

  // ===== ë“œë˜ê·¸ ê¸°ëŠ¥(ì—ëŸ¬ ì—†ì´ ì •ìƒ) =====
  wins.forEach((win) => {
    const bar = win.querySelector(".titlebar");
    if(!bar) return;

    let dragging = false;
    let startX = 0, startY = 0;
    let winX = 0, winY = 0;

    bar.addEventListener("pointerdown", (e) => {
      dragging = true;
      hasUserMoved = true;
      bringToFront(win);

      startX = e.clientX;
      startY = e.clientY;

      winX = parseFloat(win.style.left) || win.offsetLeft;
      winY = parseFloat(win.style.top)  || win.offsetTop;

      bar.setPointerCapture(e.pointerId);
      e.preventDefault();
    });

    bar.addEventListener("pointermove", (e) => {
      if(!dragging) return;

      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      let nx = winX + dx;
      let ny = winY + dy;

      const maxX = window.innerWidth - 60;
      const maxY = window.innerHeight - 120;
      nx = Math.min(Math.max(nx, -40), maxX);
      ny = Math.min(Math.max(ny, -20), maxY);

      win.style.left = nx + "px";
      win.style.top  = ny + "px";
    });

    bar.addEventListener("pointerup", () => dragging = false);
    bar.addEventListener("pointercancel", () => dragging = false);

    // í´ë¦­ë§Œ í•´ë„ ì•ìœ¼ë¡œ ì˜¤ê²Œ
    win.addEventListener("pointerdown", ()=> bringToFront(win));
  });

  window.addEventListener("load", () => autoLayout());
  window.addEventListener("resize", () => autoLayout());

  // ===== ì‹œê³„ =====
  const clock = document.getElementById("clock");
  function tick(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    clock.textContent = `${hh}:${mm}`;
  }
  tick();
  setInterval(tick, 1000 * 10);

  // ===== ìœ íŠœë¸Œ ì†Œë¦¬ ë²„íŠ¼(iframe src í† ê¸€) =====
  const ytFrame = document.getElementById("ytFrame");
  const soundBtn = document.getElementById("ytSoundBtn");
  let isMuted = true;

  soundBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const url = new URL(ytFrame.src);
    url.searchParams.set("mute", isMuted ? "0" : "1");
    ytFrame.src = url.toString();

    isMuted = !isMuted;
    soundBtn.textContent = isMuted ? "ğŸ”‡" : "ğŸ”Š";
  });
</script>

  <!-- =========================================================
       âœ… Firebase ì¹´í†¡ì‹ ìª½ì§€ (ì‹¤ì‹œê°„ + read í•„ë“œ + ì•ˆì½ìŒë±ƒì§€)
       ========================================================= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, query, where, orderBy, limit,
      serverTimestamp, doc, updateDoc, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // âœ… ë™ì¼í•´ì•¼ í•¨
    const firebaseConfig = {
      apiKey: "AIzaSyA1PxEOrwjVi4BOLA13UbFIncTYe6RdYIQ",
      authDomain: "dear-miracle.firebaseapp.com",
      projectId: "dear-miracle",
      storageBucket: "dear-miracle.firebasestorage.app",
      messagingSenderId: "793139917614",
      appId: "1:793139917614:web:dec74f65af6a0df1c740bf",
      measurementId: "G-VF22L8ZR6D"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const $ = (id)=>document.getElementById(id);

    // ===== ë‹‰ë„¤ì„ =====
    const NICK_KEY = "dm_nick";
    function getNick(){ return (localStorage.getItem(NICK_KEY) || "").trim(); }
    function setNick(n){ localStorage.setItem(NICK_KEY, (n||"").trim()); }

    function fmtTime(ts){
      if(!ts) return "";
      try{
        const d = ts.toDate ? ts.toDate() : new Date(ts);
        const yy = String(d.getFullYear()).slice(2);
        const mm = String(d.getMonth()+1).padStart(2,"0");
        const dd = String(d.getDate()).padStart(2,"0");
        const hh = String(d.getHours()).padStart(2,"0");
        const mi = String(d.getMinutes()).padStart(2,"0");
        return `${yy}.${mm}.${dd} ${hh}:${mi}`;
      }catch{
        return "";
      }
    }

    // ===== UI =====
    const dmFabBtn = $("dmFabBtn");
    const dmBadge  = $("dmBadge");

    const dmBg = $("dmBg");
    const dmCloseBtn = $("dmCloseBtn");
    const dmRefresh = $("dmRefresh");
    const dmNickBtn = $("dmNickBtn");
    const dmHint = $("dmHint");

    const roomList = $("roomList");
    const roomHint = $("roomHint");

    const chatWith = $("chatWith");
    const chatHintTop = $("chatHintTop");
    const chatList = $("chatList");
    const chatInput = $("chatInput");
    const chatSend = $("chatSend");
    const chatBackBtn = $("chatBackBtn");

    // ë‹‰ ëª¨ë‹¬
    const nickBg = $("nickBg");
    const nickClose = $("nickClose");
    const nickInput = $("nickInput");
    const nickCancel = $("nickCancel");
    const nickSave = $("nickSave");
    const nickHint = $("nickHint");

    let currentPeer = "";
    let unsubRoomsA = null;
    let unsubRoomsB = null;
    let unsubChatA = null;
    let unsubChatB = null;
    let unsubBadge = null;

    function stopRooms(){
      if(unsubRoomsA) unsubRoomsA();
      if(unsubRoomsB) unsubRoomsB();
      unsubRoomsA = unsubRoomsB = null;
    }
    function stopChat(){
      if(unsubChatA) unsubChatA();
      if(unsubChatB) unsubChatB();
      unsubChatA = unsubChatB = null;
    }
    function stopBadge(){
      if(unsubBadge) unsubBadge();
      unsubBadge = null;
    }

    function showHint(s){ dmHint.textContent = s || ""; }

    function openNickModal(force=false){
      nickHint.textContent = "";
      nickInput.value = getNick();
      nickBg.style.display = "flex";
      nickClose.style.display = force ? "none" : "block";
      setTimeout(()=> nickInput.focus(), 30);
    }
    function closeNickModal(){
      nickBg.style.display = "none";
    }
    function ensureNick(){
      const n = getNick();
      if(!n){
        openNickModal(true);
        return false;
      }
      return true;
    }

    nickSave.addEventListener("click", ()=>{
      const val = (nickInput.value || "").trim();
      if(!val){
        nickHint.textContent = "ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }
      setNick(val);
      closeNickModal();
      startBadge(); // ë‹‰ ì„¤ì • í›„ ë±ƒì§€ ì‹œì‘
    });
    nickCancel.addEventListener("click", ()=>{
      if(getNick()) closeNickModal();
      else nickHint.textContent = "ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì•¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
    });
    nickClose.addEventListener("click", closeNickModal);
    nickBg.addEventListener("click", (e)=>{ if(e.target===nickBg && getNick()) closeNickModal(); });

    // ===== ì•ˆì½ìŒ ë±ƒì§€(ì§„ì§œ read=false) =====
    function updateBadge(n){
      const num = Math.max(0, Number(n)||0);
      dmBadge.textContent = num > 99 ? "99+" : String(num);
      dmBadge.style.display = num > 0 ? "inline-flex" : "none";
    }

    function startBadge(){
      stopBadge();
      const me = getNick();
      if(!me){ updateBadge(0); return; }

      const qy = query(
        collection(db, "messages"),
        where("to", "==", me),
        where("read", "==", false)
      );

      unsubBadge = onSnapshot(qy, (snap)=>{
        updateBadge(snap.size);
      });
    }

    // ===== ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° =====
    function openDM(){
      if(!ensureNick()) return;
      dmBg.style.display = "flex";
      showHint("");
      showRooms();
      startRooms();
    }
    function closeDM(){
      dmBg.style.display = "none";
      showHint("");
      stopRooms();
      stopChat();
    }

    dmFabBtn.addEventListener("click", openDM);
    dmCloseBtn.addEventListener("click", closeDM);
    dmBg.addEventListener("click", (e)=>{ if(e.target===dmBg) closeDM(); });
    dmNickBtn.addEventListener("click", ()=> openNickModal(false));
    dmRefresh.addEventListener("click", ()=>{
      if(!ensureNick()) return;
      if(currentPeer){
        stopChat();
        startChat(currentPeer);
      }else{
        stopRooms();
        startRooms();
      }
    });

    function showRooms(){
      currentPeer = "";
      chatBackBtn.style.display = "none";
      chatWith.textContent = "ëŒ€í™”ë¥¼ ì„ íƒí•˜ì„¸ìš”";
      chatHintTop.textContent = "";
      chatList.innerHTML = "";
      chatInput.value = "";
      roomHint.textContent = "";
    }

    function showChat(peer){
      currentPeer = peer;
      chatBackBtn.style.display = "inline-flex";
      chatWith.textContent = `ìƒëŒ€: ${peer}`;
      chatHintTop.textContent = "";
      chatList.innerHTML = "";
      chatInput.value = "";
    }

    chatBackBtn.addEventListener("click", ()=>{
      stopChat();
      showRooms();
      startRooms();
    });

    // ===== ëŒ€í™”ë°© ëª©ë¡ ì‹¤ì‹œê°„(ë°›ì€+ë³´ë‚¸ í•©ì³ì„œ ë°© ë§Œë“¤ê¸°) =====
    function renderRoomsFromMixed(all, me){
      roomList.innerHTML = "";
      if(all.length === 0){
        roomHint.textContent = "ìª½ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      // ìµœì‹ ìˆœ ì •ë ¬
      all.sort((a,b)=>{
        const at = a.createdAt?.toMillis ? a.createdAt.toMillis() : 0;
        const bt = b.createdAt?.toMillis ? b.createdAt.toMillis() : 0;
        return bt - at;
      });

      // ìƒëŒ€ë°© ê¸°ì¤€ ë°© ë¬¶ê¸° + ì•ˆì½ìŒ(ìƒëŒ€->ë‚˜ read=false) ì¹´ìš´íŠ¸
      const rooms = new Map();
      const unreadCnt = new Map();

      for(const m of all){
        const peer = (m.from === me) ? (m.to || "") : (m.from || "");
        if(!peer) continue;

        // ìµœì‹  ë©”ì‹œì§€ 1ê°œ
        if(!rooms.has(peer)) rooms.set(peer, m);

        // ì•ˆì½ìŒ ì¹´ìš´íŠ¸(ìƒëŒ€ê°€ ë³´ë‚¸ ê²ƒ ì¤‘ read=falseë§Œ)
        if(m.to === me && m.from === peer && m.read === false){
          unreadCnt.set(peer, (unreadCnt.get(peer)||0) + 1);
        }
      }

      const frag = document.createDocumentFragment();
      for(const [peer, lastMsg] of rooms.entries()){
        const div = document.createElement("div");
        div.className = "room";
        div.onclick = ()=>{
          stopRooms();
          showChat(peer);
          startChat(peer);
        };

        const left = document.createElement("div");
        left.style.minWidth = "0";

        const name = document.createElement("div");
        name.className = "name";
        name.textContent = peer;

        const last = document.createElement("div");
        last.className = "last";
        last.textContent = lastMsg.body || "";

        left.appendChild(name);
        left.appendChild(last);

        const right = document.createElement("div");
        right.className = "right";

        const time = document.createElement("div");
        time.className = "time";
        time.textContent = fmtTime(lastMsg.createdAt);

        const badge = document.createElement("div");
        badge.className = "unread";
        const n = unreadCnt.get(peer) || 0;
        badge.textContent = n > 99 ? "99+" : String(n);
        badge.style.display = n > 0 ? "inline-flex" : "none";

        right.appendChild(time);
        right.appendChild(badge);

        div.appendChild(left);
        div.appendChild(right);
        frag.appendChild(div);
      }

      roomList.appendChild(frag);
      roomHint.textContent = "";
    }

    function startRooms(){
      if(!ensureNick()) return;
      const me = getNick();
      roomHint.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
      roomList.innerHTML = "";

      stopRooms();

      const recvQ = query(
        collection(db, "messages"),
        where("to", "==", me),
        orderBy("createdAt", "desc"),
        limit(80)
      );
      const sentQ = query(
        collection(db, "messages"),
        where("from", "==", me),
        orderBy("createdAt", "desc"),
        limit(80)
      );

      let recvArr = [];
      let sentArr = [];

      unsubRoomsA = onSnapshot(recvQ, (snap)=>{
        recvArr = [];
        snap.forEach(d => recvArr.push({ id:d.id, ...d.data() }));
        renderRoomsFromMixed([...recvArr, ...sentArr], me);
      });

      unsubRoomsB = onSnapshot(sentQ, (snap)=>{
        sentArr = [];
        snap.forEach(d => sentArr.push({ id:d.id, ...d.data() }));
        renderRoomsFromMixed([...recvArr, ...sentArr], me);
      });
    }

    // ===== ì½ìŒ ì²˜ë¦¬: ë‚´ê°€ ëŒ€í™”ì°½ ì—´ë©´ ìƒëŒ€->ë‚˜ read=false ë¥¼ read=trueë¡œ =====
    async function markRead(peer){
      const me = getNick();
      const qy = query(
        collection(db, "messages"),
        where("from", "==", peer),
        where("to", "==", me),
        where("read", "==", false),
        limit(80)
      );
      const snap = await getDocs(qy);
      const jobs = [];
      snap.forEach(d=>{
        jobs.push(updateDoc(doc(db, "messages", d.id), { read:true }));
      });
      if(jobs.length) await Promise.all(jobs);
    }

    // ===== ëŒ€í™” ì‹¤ì‹œê°„(ì–‘ìª½ ì¿¼ë¦¬ í•©ì³ì„œ ë Œë”) =====
    function startChat(peer){
      if(!ensureNick()) return;
      const me = getNick();

      stopChat();
      chatHintTop.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
      chatList.innerHTML = "";

      const aQ = query(
        collection(db, "messages"),
        where("from", "==", me),
        where("to", "==", peer),
        orderBy("createdAt", "desc"),
        limit(120)
      );
      const bQ = query(
        collection(db, "messages"),
        where("from", "==", peer),
        where("to", "==", me),
        orderBy("createdAt", "desc"),
        limit(120)
      );

      let aArr = [];
      let bArr = [];

      function render(){
        const all = [...aArr, ...bArr];
        if(all.length === 0){
          chatHintTop.textContent = "ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.";
          chatList.innerHTML = "";
          return;
        }

        all.sort((x,y)=>{
          const xt = x.createdAt?.toMillis ? x.createdAt.toMillis() : 0;
          const yt = y.createdAt?.toMillis ? y.createdAt.toMillis() : 0;
          return xt - yt;
        });

        chatList.innerHTML = "";
        const frag = document.createDocumentFragment();

        for(const m of all){
          const row = document.createElement("div");
          row.className = "chat-row";

          const bubble = document.createElement("div");
          bubble.className = "bubble" + (m.from === me ? " me" : "");
          bubble.textContent = m.body || "";

          const t = document.createElement("div");
          t.className = "t";
          t.textContent = `${m.from === me ? "ë‚˜" : (m.from || "-")} Â· ${fmtTime(m.createdAt)}`;

          bubble.appendChild(t);
          row.appendChild(bubble);
          frag.appendChild(row);
        }

        chatList.appendChild(frag);
        chatHintTop.textContent = "";
        setTimeout(()=>{ chatList.scrollTop = chatList.scrollHeight; }, 0);
      }

      unsubChatA = onSnapshot(aQ, (snap)=>{
        aArr = [];
        snap.forEach(d => aArr.push({ id:d.id, ...d.data() }));
        render();
      });

      unsubChatB = onSnapshot(bQ, async (snap)=>{
        bArr = [];
        snap.forEach(d => bArr.push({ id:d.id, ...d.data() }));
        render();

        // ìƒëŒ€ê°€ ë³´ë‚¸ ê±¸ ì½ìŒ ì²˜ë¦¬
        try{ await markRead(peer); }catch(e){}
      });
    }

    // ===== ë³´ë‚´ê¸° =====
    chatSend.addEventListener("click", async ()=>{
      if(!ensureNick()) return;
      const me = getNick();
      const peer = currentPeer;
      const body = (chatInput.value || "").trim();

      if(!peer){ showHint("ëŒ€í™” ìƒëŒ€ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
      if(!body){ showHint("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
      if(peer === me){ showHint("ìê¸° ìì‹ ì—ê²ŒëŠ” ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }

      try{
        chatSend.disabled = true;
        showHint("ì „ì†¡ ì¤‘â€¦");

        await addDoc(collection(db, "messages"), {
          from: me,
          to: peer,
          body,
          postId: "",
          read: false,
          createdAt: serverTimestamp()
        });

        chatInput.value = "";
        showHint("");
      }catch(err){
        console.error(err);
        showHint("ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }finally{
        chatSend.disabled = false;
      }
    });

    // ì—”í„°ë¡œ ë³´ë‚´ê¸°(Shift+EnterëŠ” ì¤„ë°”ê¿ˆ)
    chatInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        chatSend.click();
      }
    });

    // ===== ì´ˆê¸° êµ¬ë™ =====
    // ë‹‰ ìˆìœ¼ë©´ ë±ƒì§€ ì‹¤ì‹œê°„ ì‹œì‘
    if(getNick()) startBadge();
  </script>
</body>
</html>
