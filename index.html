<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dear Miracle</title>

  <style>
    
    @font-face {
    font-family: 'RoundedFixedsys';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
    font-weight: normal;
    font-display: swap;
    }
    
    

    /* �� �고듃 媛뺤젣 �곸슜(�ㅻⅨ �ㅽ��쇱씠 ��뼱�⑤룄 �좎�) */
    html, body, button, input, textarea {
      font-family: 'RoundedFixedsys', system-ui, -apple-system, 'Segoe UI', Arial, sans-serif !important;
    }

body {
    font-family: 'RoundedFixedsys', sans-serif;
    }
    
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'RoundedFixedsys', system-ui, -apple-system, 'Segoe UI', Arial, sans-serif;
      overflow: hidden;
      background: #000;
    }

    :root{
      --titlebar-top: #f7f7f7;
      --titlebar-bot: #e9e9e9;

      --frame: rgba(255,255,255,0.60);
      --glass: rgba(255,255,255,0.40);
      --border: rgba(0,0,0,0.30);

      --shadow: 0 12px 30px rgba(0,0,0,0.22);
      --shadow-strong: 0 18px 46px rgba(0,0,0,0.30);

      --text: #1b1b1b;
      --muted: rgba(0,0,0,0.55);
    }

    .wallpaper {
      position: fixed;
      inset: 0;
      background-image: url("bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: saturate(0.95) contrast(0.98);
      transform: scale(1.02);
    }

    .wallpaper::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(1200px 600px at 20% 15%, rgba(255,255,255,0.30), transparent 60%),
        radial-gradient(900px 500px at 80% 25%, rgba(255,255,255,0.22), transparent 55%),
        radial-gradient(900px 700px at 55% 80%, rgba(255,255,255,0.18), transparent 60%),
        linear-gradient(to bottom, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      pointer-events:none;
    }

    .desk {
      position: fixed;
      inset: 0;
      pointer-events: none;
    }

    .win {
      position: absolute;
      width: 420px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      background: var(--frame);

      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);

      pointer-events: auto;
      user-select: none;
      z-index: 10;
    }

    .win.is-front { box-shadow: var(--shadow-strong); }

    .titlebar {
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 8px 0 10px;

      background: linear-gradient(to bottom, var(--titlebar-top), var(--titlebar-bot));
      border-bottom: 1px solid rgba(0,0,0,0.18);

      color: #222;
      text-shadow: none;
      cursor: grab;
    }
    .titlebar:active { cursor: grabbing; }

    .title-left {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 2px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.75);
      flex: 0 0 auto;
    }

    .title {
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 280px;
    }

    .title-btns {
      display: flex;
      gap: 6px;
      flex: 0 0 auto;
    }

    .btn {
      width: 16px;
      height: 16px;
      border-radius: 2px;
      border: 1px solid rgba(0,0,0,0.35);
      background: rgba(255,255,255,0.85);
      box-shadow: inset 0 -1px 0 rgba(0,0,0,0.12);
    }

    .content {
      background: var(--glass);
      padding: 8px;
    }

    .media {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.18);
      background: rgba(255,255,255,0.35);
    }
    .media img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
    }

    .meta {
      margin-top: 6px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      padding: 4px 6px;
      border-radius: 6px;
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(0,0,0,0.12);
    }

    .note {
      padding: 10px 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.14);
      background: rgba(255,255,255,0.62);
      color: #222;
      font-size: 13px;
      line-height: 1.35;
    }
    .note b { display:block; margin-bottom: 6px; }
    .note ul { margin: 8px 0 0 18px; padding:0; }
    .note li { margin: 3px 0; }
    .note a { color:#0b57d0; text-decoration: underline; }

    .taskbar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 44px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 12px;

      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);

      border-top: 1px solid rgba(0,0,0,0.18);
    }

    .start {
      height: 30px;
      padding: 0 12px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.80);
      font-weight: 700;
      font-size: 12px;
      display:flex;
      align-items:center;
      gap: 8px;
      cursor: pointer;
    }

    .brand {
      font-size: 13px;
      color: #222;
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .spacer { flex: 1; }
    .clock {
      font-size: 12px;
      color: rgba(0,0,0,0.65);
      font-variant-numeric: tabular-nums;
    }

    @media (max-width: 480px){
      .win { width: min(86vw, 320px); }
  .win.media-win { width: min(78vw, 320px); }
      .title { max-width: 220px; }
    }

    /* ===== YouTube playlist window ===== */
    .yt-window { width: 280px; }
    .yt-window .content { padding: 0; background: #fff; }
    .yt-window iframe {
      width: 100%;
      height: 190px;
      border: 0;
      display: block;
    }
    .yt-window .titlebar .buttons {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .yt-window .sound-btn {
      font-size: 12px;
      padding: 2px 8px;
      border: 1px solid rgba(0,0,0,0.25);
      border-radius: 6px;
      background: rgba(255,255,255,0.85);
      cursor: pointer;
    }
    .yt-window .sound-btn:active { transform: translateY(1px); }

    /* =========================================================
       �� 移댄넚�� 履쎌�: FAB + �덉씫�� 諭껋� + ���붾갑紐⑸줉/���붿갹 紐⑤떖
       ========================================================= */
    .dm-fab{
      position: fixed;
      right: 18px;
      bottom: 64px;
      z-index: 99999;
      pointer-events: auto;
    }
    .dm-fab button{
      width: 64px;
      height: 64px;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.78);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 14px 40px rgba(0,0,0,0.25);
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 28px;
      line-height: 1;
    }
    .dm-fab button:active{ transform: translateY(1px); }

    .dm-badge{
      position: absolute;
      top: -6px;
      right: -6px;
      min-width: 26px;
      height: 26px;
      padding: 0 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 13px;
      display:none;
      align-items:center;
      justify-content:center;
    }

    @media (max-width: 560px){
      .dm-fab{ right: 14px; bottom: 66px; }
      .dm-fab button{
        width: 78px;
        height: 78px;
        border-radius: 22px;
        font-size: 34px;
      }
      .dm-badge{
        min-width: 30px;
        height: 30px;
        font-size: 14px;
      }
    }

    .dm-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 99998;
      pointer-events: auto;
    }
    .dm-modal{
      width: min(920px, 100%);
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(0,0,0,0.18);
      border-radius: 12px;
      overflow:hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .dm-modal .titlebar{ cursor: default; }
    .dm-modal .content{ background: transparent; padding: 0; }

    .dm-head{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
      padding: 10px;
      background: rgba(255,255,255,0.55);
      border-bottom: 1px solid rgba(0,0,0,0.12);
    }
    .dm-tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .dm-pill{
      height: 36px;
      padding: 0 12px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 13px;
      cursor: pointer;
    }
    .dm-pill.ghost{ background: rgba(255,255,255,0.65); }
    .dm-pill:active{ transform: translateY(1px); }

    .dm-body{
      padding: 10px;
    }

    /* ====== 移댄넚�� �덉씠�꾩썐 ====== */
    .dm-split{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 10px;
    }
    @media (max-width: 860px){
      .dm-split{ grid-template-columns: 1fr; }
    }

    .panel{
      background: rgba(255,255,255,0.62);
      border: 1px solid rgba(0,0,0,0.14);
      border-radius: 12px;
      overflow:hidden;
    }
    .panel .ph{
      padding: 10px 12px;
      font-weight: 900;
      font-size: 13px;
      color: rgba(0,0,0,0.70);
      background: rgba(255,255,255,0.55);
      border-bottom: 1px solid rgba(0,0,0,0.12);
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 8px;
    }

    .rooms{
      max-height: min(62vh, 560px);
      overflow:auto;
    }
    .room{
      padding: 10px 12px;
      border-top: 1px solid rgba(0,0,0,0.08);
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 10px;
    }
    .room:hover{ background: rgba(255,255,255,0.55); }
    .room .name{
      font-weight: 900;
      font-size: 14px;
      color:#222;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 220px;
    }
    .room .last{
      font-size: 12px;
      color: rgba(0,0,0,0.60);
      margin-top: 4px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 220px;
    }
    .room .right{
      display:flex;
      flex-direction: column;
      align-items:flex-end;
      gap: 6px;
      flex: 0 0 auto;
    }
    .room .time{
      font-size: 11px;
      color: rgba(0,0,0,0.55);
      font-variant-numeric: tabular-nums;
    }
    .room .unread{
      min-width: 22px;
      height: 22px;
      padding: 0 7px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.18);
      background: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 12px;
      display:none;
      align-items:center;
      justify-content:center;
    }

    .chat{
      display:flex;
      flex-direction: column;
      height: min(62vh, 560px);
    }
    .chat-list{
      flex: 1;
      overflow:auto;
      padding: 12px;
      display:flex;
      flex-direction: column;
      gap: 8px;
    }
    .chat-row{ display:flex; }
    .bubble{
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.14);
      background: rgba(255,255,255,0.70);
      color:#222;
      font-size: 14px;
      line-height: 1.45;
      white-space: pre-wrap;
      position: relative;
    }
    .bubble.me{
      margin-left: auto;
      background: rgba(255,255,255,0.92);
    }
    .bubble .t{
      margin-top: 6px;
      font-size: 11px;
      color: rgba(0,0,0,0.55);
      font-variant-numeric: tabular-nums;
    }

    .chat-send{
      padding: 10px;
      border-top: 1px solid rgba(0,0,0,0.12);
      display:flex;
      gap: 8px;
      align-items: flex-end;
      background: rgba(255,255,255,0.55);
    }
    .chat-send textarea{
      flex: 1;
      min-height: 44px;
      max-height: 160px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.18);
      background: rgba(255,255,255,0.90);
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      line-height: 1.45;
    }

    .dm-hint{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(0,0,0,0.60);
      line-height: 1.35;
      min-height: 18px;
    }
    /* �곗륫 �섎떒 硫붿떊�� 踰꾪듉: �용튆 寃��뺤쑝濡� 媛��쒖꽦 �� */
.dm-fab button{
  background: rgba(25,25,28,0.88) !important;
  border: 1px solid rgba(255,255,255,0.18) !important;
  box-shadow: 0 16px 46px rgba(0,0,0,0.45) !important;
  color: rgba(255,255,255,0.92) !important;
}

.dm-fab button:hover{
  background: rgba(35,35,40,0.92) !important;
}

.dm-fab button:active{
  transform: translateY(1px);
}

/* 諭껋��� �대몢�� 踰꾪듉 �꾩뿉�� �� 蹂댁씠寃� */
.dm-badge{
  background: rgba(255,255,255,0.95) !important;
  color: rgba(0,0,0,0.85) !important;
  border: 1px solid rgba(0,0,0,0.25) !important;
}
/* �쇱そ �덈궡李� �덉쓽 硫붿떊�� �덈궡臾� */
.dm-guide{
  margin-top: 10px;
  padding: 10px 10px;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,0.14);
  background: rgba(255,255,255,0.72);
  font-size: 13px;
  line-height: 1.35;
  color: rgba(0,0,0,0.75);
}
.dm-guide b{
  font-weight: 900;
  color: rgba(0,0,0,0.88);
}
    /* =========================
   �벑 Mobile layout fix
   ========================= */
@media (max-width: 560px){

  /* 諛뷀깢 �ㅽ겕濡�/以� �덉젙 */
  html, body { overflow: hidden; }

  /* �� 蹂대뱶 硫붿씤李�: 嫄곗쓽 ���붾㈃ */
  #boardWin{
    left: 10px !important;
    top: 10px !important;
    width: calc(100vw - 20px) !important;
    height: calc(100vh - 74px) !important; /* �꾨옒 taskbar(44px) + �ъ쑀 */
  }

  /* �� 蹂대뱶 �대� 由ъ뒪�� �ㅽ겕濡� 怨듦컙 �뺣낫 */
  #boardWin .list{
    max-height: calc(100vh - 260px) !important;
  }

  /* �� 硫붿떊��(履쎌�) 紐⑤떖/李쎌씠 �덈Т 而ㅼ�硫� ���� */
  .modal{
    width: calc(100vw - 20px) !important;
    max-height: calc(100vh - 40px) !important;
  }
  .modal .content{
    max-height: calc(100vh - 120px) !important;
    overflow: auto !important;
  }

  /* �� �좏뒠釉� 李�(�덈떎硫�) : �묎쾶 + �쒖そ 援ъ꽍 */
  #ytWin{
    width: 220px !important;
    height: 160px !important;
    left: 12px !important;
    top: auto !important;
    bottom: 64px !important; /* taskbar �� */
    right: auto !important;
  }

  /* �� �곸긽/�대�吏� 李쎈뱾: 泥섏쓬�� �④꺼踰꾨━湲� (寃뱀묠 諛⑹�) */
  .win[data-key^="0722_"],
  .win.videoWin,
  .win.photoWin{
    display: none !important;
  }
}
  
    /* UX: 紐⑤컮�쇱뿉�� �뚯냼嫄� 踰꾪듉/�덈궡 媛뺥솕 */
    .sound-btn{
      display:flex; align-items:center; gap:6px;
      padding:6px 10px;
      border-radius:10px;
      font-weight:900;
      white-space:nowrap;
    }
    .sound-label{ font-size:13px; }
    .mute-hint{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(0,0,0,.06);
      font-size:13px;
      line-height:1.3;
    }
    .mute-hint b{ font-weight:900; }

    
/* ===== floating sticker layer ===== */
.floating-stickers {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}
.sticker {
  position: absolute;
  opacity: 0.35;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,0.18));
  animation: floatY 6s ease-in-out infinite;
}
.sticker.vhs { width:120px; left:6%; bottom:18%; animation-duration:7s; }
.sticker.headphone { width:140px; right:8%; top:12%; animation-duration:6.5s; }
.sticker.camera { width:110px; left:12%; top:10%; animation-duration:5.8s; }
.sticker.wings { width:160px; right:10%; bottom:14%; animation-duration:8s; }
@keyframes floatY {
  0% { transform: translateY(0) rotate(var(--rot, 0deg)); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0); }
}
@media (max-width:768px){ .sticker{ opacity:0.18; } }
@media (min-width:769px){ .sticker{ opacity:0.25; } }


/* mobile: keep stickers in the background edges (no UI blocking) */
@media (max-width:768px){
  .sticker.vhs{ width:84px; left:6%; bottom:6%; }
  .sticker.headphone{ width:96px; right:4%; top:4%; }
  .sticker.camera{ width:74px; right:6%; top:54%; left:auto; }
}


/* sticker: slight rotation for "real sticker" vibe */
.sticker.vhs{ --rot: -6deg; }
.sticker.headphone{ --rot: 5deg; }
.sticker.camera{ --rot: -4deg; }


/* ===== schedule ticket (background decorative) ===== */
.schedule-ticket{
  position: fixed;
  left: 6%;
  top: 58%;
  transform: rotate(-4deg);
  z-index: -1;
  pointer-events: none;
  font-family: 'RoundedFixedsys', monospace;
  background: rgba(255,255,255,0.55);
  border: 1px dashed rgba(0,0,0,0.25);
  border-radius: 14px;
  padding: 14px 16px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

.schedule-ticket .ticket-line{
  font-size: 12px;
  line-height: 1.4;
  margin: 2px 0;
  white-space: nowrap;
}

.schedule-ticket .ticket-line.w{ color: rgba(0,0,0,0.85); }
.schedule-ticket .ticket-line.b{ color: rgba(0,0,0,0.65); }

.schedule-ticket .ticket-gap{
  height: 8px;
}

@media (max-width: 768px){
  .schedule-ticket{
    left: 50%;
    top: 72%;
    transform: translateX(-50%) rotate(-2deg);
    opacity: 0.35;
  }
}

</style>
  <link rel="stylesheet" href="mobile-fix.css">
</head>

<body>
  <div class="wallpaper"></div>

  <div class="desk" id="desk">

    <!-- 0) 怨듭�/寃뚯떆�� �덈궡 李� -->
    <div class="win is-front" data-key="notice" style="left:18px; top:18px; width: 260px;" data-z="300">
      <div class="titlebar">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title">援ъ씤 寃뚯떆��</div>
        </div>
        <div class="title-btns">
          <div class="btn"></div><div class="btn"></div><div class="btn"></div>
        </div>
      </div>
      <div class="content">
        <div class="note">
          <b>Dear Miracle</b>
          媛�媛쒖옣 湲곌컙 �숈븞留� �댁쁺�⑸땲��.
          <ul>
            <li>援ъ씤寃뚯떆��: �꾩껜 怨듦컻 (蹂몄씤 �됰꽕�꾨쭔 �뺤씤�댁＜�쒓린 諛붾엻�덈떎.) </li>
            <li>�꾨즺 �� 寃뚯떆湲� 諛묒뿉 愿�怨� �� 以� �붿빟 湲곗옱</li>
          </ul>
          <div class="dm-guide">
  �벃 而⑦깮/履쎌��� <b>�곗륫 �섎떒 硫붿떊��</b>瑜� �댁슜�댁＜�몄슂.
</div>
          <div style="margin-top:10px;">
            <a href="board.html">寃뚯떆�� �ㅼ뼱媛�湲�</a>
          </div>
        </div>
      </div>
    </div>

    <!-- �벃 硫붿떊�� �덈궡 -->
<div class="win" data-key="dm-notice"
     style="left:920px; top:520px; width:260px;" data-z="18">

  <div class="titlebar">
    <div class="title-left">
      <div class="dot"></div>
      <div class="title">硫붿떊��</div>
    </div>
    <div class="title-btns">
      <div class="btn"></div><div class="btn"></div><div class="btn"></div>
    </div>
  </div>

  <div class="content">
    <div class="note">
      <b>而⑦깮 / 履쎌�</b>
      �ㅻⅨ履� �섎떒 硫붿떊��瑜�<br>
      �댁슜�댁＜�몄슂.

     <div style="display:flex; gap:10px; margin-top:12px;">

  <!-- 硫붿떊�� 踰꾪듉 -->
<div style="margin-top:12px; display:flex; gap:10px;">
  <button
    onclick="document.getElementById('dmFabBtn').click()"
    style="
      flex:1;
      padding:12px 0;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.25);
      background:rgba(0,0,0,0.78);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      font-size:14px;
    ">
    而⑦깮 �뺤씤�섍린
  </button>

  <button
    onclick="location.href='board.html'"
    style="
      width:110px;
      padding:12px 0;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.18);
      background:rgba(255,255,255,0.85);
      color:#111;
      font-weight:800;
      cursor:pointer;
      font-size:14px;
    ">
    寃뚯떆��
  </button>
</div>

    </div>
  </div>
</div>
</div>


    <!-- 1 -->
    <div class="win media-win" data-key="w1" style="left:270px; top:70px;" data-z="10">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_002.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img01.jpg" alt=""></div>
        <div class="meta"><span>Preview 쨌 File 쨌 Edit 쨌 View</span><span>��</span></div>
      </div>
    </div>

    <!-- 2 -->
    <div class="win media-win" data-key="w2" style="left:510px; top:92px; width: 360px;" data-z="11">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_006.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img02.jpg" alt=""></div>
        <div class="meta"><span>00:17</span><span> </span></div>
      </div>
    </div>

    <!-- 3 -->
<div class="win media-win" data-key="w3" style="left:260px; top:290px; width: 520px;" data-z="12">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_003.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img03.jpg" alt=""></div>
        <div class="meta"><span>�� 02:47</span><span> </span></div>
      </div>
    </div>

    <!-- 4 -->
    <div class="win media-win" data-key="w4" style="left:40px; top:520px; width: 440px;" data-z="13">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_004.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img04.jpg" alt=""></div>
        <div class="meta"><span>Saved 1 min ago</span><span> </span></div>
      </div>
    </div>

    <!-- 5 -->
    <div class="win media-win" data-key="w5" style="left:380px; top:520px; width: 520px;" data-z="14">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_005.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img05.jpg" alt=""></div>
        <div class="meta"><span>Continue listening?</span><span> </span></div>
      </div>
    </div>

    <!-- 6 -->
<div class="win media-win" data-key="w6" style="left:680px; top:300px; width: 500px;" data-z="15">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_007.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img06.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- 7 -->
    <div class="win media-win" data-key="w7" style="left:860px; top:70px; width: 260px;" data-z="16">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_008.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img07.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- 8 -->
    <div class="win media-win" data-key="w8" style="left:880px; top:430px; width: 320px;" data-z="17">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_009.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img08.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- 8 -->
<div class="win media-win" data-key="w8" style="left:1030px; top:470px; width: 320px;" data-z="17">
      <div class="titlebar">
        <div class="title-left"><div class="dot"></div><div class="title">0722_1029_010.mp4</div></div>
        <div class="title-btns"><div class="btn"></div><div class="btn"></div><div class="btn"></div></div>
      </div>
      <div class="content">
        <div class="media"><img src="img09.jpg" alt=""></div>
        <div class="meta"><span> </span><span> </span></div>
      </div>
    </div>

    <!-- �렦 YouTube Playlist Window -->
<div class="win media-win yt-window" data-key="yt" id="ytWin" style="top:520px; left:520px;" data-z="9">
      <div class="titlebar" id="ytDrag">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title">0722_1029_011.mp4</div>
        </div>
        <div class="title-btns">
          <button class="sound-btn" id="ytSoundBtn" title="�뚯냼嫄� �댁젣" aria-label="�뚯냼嫄� �댁젣">�뵁 <span class="sound-label">�뚯냼嫄� �댁젣</span></button>
          <div class="btn"></div><div class="btn"></div><div class="btn"></div>
        </div>
      </div>

      <div class="content">
        <iframe
          id="ytFrame"
          src="https://www.youtube.com/embed/videoseries?list=PLUE3Cb-ZSnOeLPneQRPY76iI9h9NCQMp6&autoplay=1&loop=1&mute=1"
          allow="autoplay; encrypted-media"
          allowfullscreen>
        </iframe>
        <div id="ytMuteHint" class="mute-hint">�꾩옱 <b>�뚯냼嫄�</b> �곹깭�덉슂. �� 踰꾪듉�� <b>�뚯냼嫄� �댁젣</b>瑜� �뚮윭二쇱꽭��.</div>
      </div>
    </div>

  </div>

  <!-- �� 履쎌� �꾩씠肄� -->
  <div class="dm-fab">
    <button id="dmFabBtn" title="履쎌���">�됵툘</button>
    <div class="dm-badge" id="dmBadge">0</div>
  </div>

  <!-- �� 移댄넚�� 硫붿떊�� 紐⑤떖 -->
  <div class="dm-backdrop" id="dmBg">
    <div class="dm-modal">
      <div class="titlebar" style="cursor:default;">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title" id="dmTitle">�� 履쎌���</div>
        </div>
        <div class="title-btns">
          <div class="btn" id="dmCloseBtn" title="�リ린"></div>
        </div>
      </div>

      <div class="dm-head">
        <div class="dm-tabs">
          <button class="dm-pill ghost" id="chatBackBtn" style="display:none;">�� 紐⑸줉</button>
          <button class="dm-pill" id="dmRefresh">�덈줈怨좎묠</button>
        </div>
        <button class="dm-pill" id="dmNickBtn">�됰꽕��</button>
      </div>

      <div class="dm-body">
        <div class="dm-split">

          <!-- �쇱そ: ���붾갑 紐⑸줉 -->
          <div class="panel" id="roomPanel">
            <div class="ph">
              <span>����</span>
              <span style="font-size:11px;color:rgba(0,0,0,0.55);" id="roomHint"></span>
            </div>
            <div class="rooms" id="roomList"></div>
          </div>

          <!-- �ㅻⅨ履�: ���붿갹 -->
          <div class="panel" id="chatPanel">
            <div class="ph">
              <span id="chatWith">���붾� �좏깮�섏꽭��</span>
              <span style="font-size:11px;color:rgba(0,0,0,0.55);" id="chatHintTop"></span>
            </div>

            <div class="chat">
              <div class="chat-list" id="chatList"></div>
              <div class="chat-send">
                <textarea id="chatInput" placeholder="硫붿떆吏� �낅젰��"></textarea>
                <button class="dm-pill" id="chatSend">蹂대궡湲�</button>
              </div>
            </div>
          </div>

        </div>

        <div class="dm-hint" id="dmHint"></div>
      </div>
    </div>
  </div>
<div class="brand">Dear Miracle</div>
    <div class="spacer"></div>
    <div class="clock" id="clock">--:--</div>
  </div>

  <!-- �� �됰꽕�� �낅젰(�� 怨듭쑀: localStorage "dm_nick") -->
  <div class="dm-backdrop" id="nickBg" style="z-index: 100000; display:none;">
    <div class="dm-modal" style="width: min(520px, 100%);">
      <div class="titlebar" style="cursor: default;">
        <div class="title-left">
          <div class="dot"></div>
          <div class="title">�됰꽕�� �낅젰</div>
        </div>
        <div class="title-btns">
          <div class="btn" id="nickClose" title="�リ린"></div>
        </div>
      </div>
      <div class="dm-body">
        <div style="display:block;">
          <div class="field" style="display:grid; gap:6px; margin-bottom:10px;">
            <div class="label" style="font-size:12px;color:rgba(0,0,0,0.65);font-weight:900;">�됰꽕��</div>
            <input id="nickInput" placeholder="��: DearMiracle / �뉎뀋 / �됰꽕��" maxlength="30"
              style="width:100%;border-radius:12px;border:1px solid rgba(0,0,0,0.18);background:rgba(255,255,255,0.90);padding:11px 12px;font-size:14px;outline:none;" />
          </div>
          <div class="dm-actions" style="display:flex; gap:8px; justify-content:flex-end;">
            <button class="dm-pill ghost" id="nickCancel">痍⑥냼</button>
            <button class="dm-pill" id="nickSave">�뺤씤</button>
          </div>
        </div>
        <div class="dm-hint" id="nickHint"></div>
      </div>
    </div>
  </div>

  <script>
  // ===== 李� �쒕옒洹� + �욎쑝濡� 媛��몄삤湲� + (泥� 濡쒕뵫) �붾㈃蹂� �먮룞 諛곗튂 =====
  const wins = Array.from(document.querySelectorAll(".win"));
  let topZ = 100;
  let hasUserMoved = false;

  function bringToFront(win){
    topZ += 1;
    win.style.zIndex = topZ;
    wins.forEach(w => w.classList.remove("is-front"));
    win.classList.add("is-front");
  }

  function clamp(n, min, max){ return Math.min(Math.max(n, min), max); }

  function place(win, x01, y01){
    const taskbar = document.querySelector(".taskbar");
    const taskH = taskbar ? taskbar.offsetHeight : 44;

    const vw = window.innerWidth;
    const vh = window.innerHeight;

    const marginX = 18;
    const marginTop = 18;
    const marginBottom = taskH + 18;

    const w = win.offsetWidth;
    const h = win.offsetHeight;

    const usableW = vw - marginX*2 - w;
    const usableH = vh - marginTop - marginBottom - h;

    let left = marginX + (usableW * x01);
    let top  = marginTop + (usableH * y01);

    // �붾㈃ 諛뽰쑝濡� �덈Т �섍�吏� �딄쾶
    const maxX = vw - 60;
    const maxY = vh - 120;
    left = clamp(left, -40, maxX);
    top  = clamp(top,  -20, maxY);

    win.style.left = left + "px";
    win.style.top  = top  + "px";
  }

  function autoLayout(){
    if(hasUserMoved) return;

    const byKey = {};
    wins.forEach(w => { byKey[w.dataset.key] = w; });

    const vw = window.innerWidth;

    // ===== PC (�먮옒 踰꾩쟾) =====
    if(vw >= 1100){
 if(byKey.notice) place(byKey.notice, 0.02, 0.03);
  if(byKey.yt) place(byKey.yt, 0.05, 0.50);

      if(byKey.w1)     place(byKey.w1,     0.31, 0.02);
      if(byKey.w2)     place(byKey.w2,     0.50, 0.15);
      if(byKey.w3)     place(byKey.w3,     0.28, 0.42);

      if(byKey.w4)     place(byKey.w4,     0.05, 0.78);
      if(byKey.w5)     place(byKey.w5,     0.35, 0.95);

      if(byKey.w7)     place(byKey.w7,     0.78, 0.10);
      if(byKey.w6)     place(byKey.w6,     0.70, 0.45);
      if(byKey.w8)     place(byKey.w8,     0.88, 0.77);
      if(byKey.w10)    place(byKey.w10,    0.92, 0.66);
      if(byKey["dm-notice"]) place(byKey["dm-notice"], 0.92, 0.40);

      return;
    }

    // ===== �쒕툝由� (�먮옒 踰꾩쟾) =====
    if(vw >= 700){
      if(byKey.notice) place(byKey.notice, 0.03, 0.03);
      if(byKey.yt)     place(byKey.yt,     0.03, 0.55);

      if(byKey.w1)     place(byKey.w1,     0.45, 0.10);
      if(byKey.w2)     place(byKey.w2,     0.45, 0.35);
      if(byKey.w3)     place(byKey.w3,     0.20, 0.30);

      if(byKey.w4)     place(byKey.w4,     0.03, 0.78);
      if(byKey.w5)     place(byKey.w5,     0.45, 0.78);

      if(byKey.w6)     place(byKey.w6,     0.70, 0.50);
      if(byKey.w7)     place(byKey.w7,     0.70, 0.05);
      if(byKey.w8)     place(byKey.w8,     0.70, 0.70);

      if(byKey.w10)    place(byKey.w10,    0.45, 0.60);
      return;
    }

    // ===== 紐⑤컮�� (�먮옒 踰꾩쟾) =====
    const order = ["notice","yt","w1","w2","w3","w4","w5","w6","w7","w8","w10","dm-notice"];
    let y = 0.03;
    order.forEach((k, i) => {
      const w = byKey[k];
      if(!w) return;
      place(w, (i % 2 ? 0.08 : 0.02), y);
      y += 0.07;
    });
  }

  // ===== �쒕옒洹� 湲곕뒫(�먮윭 �놁씠 �뺤긽) =====
  wins.forEach((win) => {
    const bar = win.querySelector(".titlebar");
    if(!bar) return;

    let dragging = false;
    let startX = 0, startY = 0;
    let winX = 0, winY = 0;

    bar.addEventListener("pointerdown", (e) => {
      dragging = true;
      hasUserMoved = true;
      bringToFront(win);

      startX = e.clientX;
      startY = e.clientY;

      winX = parseFloat(win.style.left) || win.offsetLeft;
      winY = parseFloat(win.style.top)  || win.offsetTop;

      bar.setPointerCapture(e.pointerId);
      e.preventDefault();
    });

    bar.addEventListener("pointermove", (e) => {
      if(!dragging) return;

      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      let nx = winX + dx;
      let ny = winY + dy;

      const maxX = window.innerWidth - 60;
      const maxY = window.innerHeight - 120;
      nx = Math.min(Math.max(nx, -40), maxX);
      ny = Math.min(Math.max(ny, -20), maxY);

      win.style.left = nx + "px";
      win.style.top  = ny + "px";
    });

    bar.addEventListener("pointerup", () => dragging = false);
    bar.addEventListener("pointercancel", () => dragging = false);

    // �대┃留� �대룄 �욎쑝濡� �ㅺ쾶
    win.addEventListener("pointerdown", ()=> bringToFront(win));
  });

  window.addEventListener("load", () => {
    autoLayout();
    // 泥� 諛⑸Ц�� UX: 援ъ씤 寃뚯떆�� 諛붾줈媛�湲곕� ��긽 留� �욎뿉
    const noticeWin = byKey.get("notice");
    if (noticeWin) bringToFront(noticeWin);
  });
  window.addEventListener("resize", () => autoLayout());

  // ===== �쒓퀎 =====
  const clock = document.getElementById("clock");
  function tick(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    clock.textContent = `${hh}:${mm}`;
  }
  tick();
  setInterval(tick, 1000 * 10);

  // ===== �좏뒠釉� �뚮━ 踰꾪듉(iframe src �좉�) =====
  const ytFrame = document.getElementById("ytFrame");
  const soundBtn = document.getElementById("ytSoundBtn");
  let isMuted = true;
  if (soundBtn) soundBtn.innerHTML = "�뵁 <span class=\"sound-label\">�뚯냼嫄� �댁젣</span>";
  const _hint0 = document.getElementById("ytMuteHint");
  if (_hint0) _hint0.style.display = "block";

  soundBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const url = new URL(ytFrame.src);
    url.searchParams.set("mute", isMuted ? "0" : "1");
    ytFrame.src = url.toString();

    isMuted = !isMuted;
    soundBtn.innerHTML = isMuted ? "�뵁 <span class=\"sound-label\">�뚯냼嫄� �댁젣</span>" : "�뵄 <span class=\"sound-label\">�뚮━ �꾧린</span>";
    const hint = document.getElementById("ytMuteHint");
    if (hint) hint.style.display = isMuted ? "block" : "none";
  });
</script>

  <!-- =========================================================
       �� Firebase 移댄넚�� 履쎌� (�ㅼ떆媛� + read �꾨뱶 + �덉씫�뚮콇吏�)
       ========================================================= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, query, where, orderBy, limit,
      serverTimestamp, doc, updateDoc, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // �� �숈씪�댁빞 ��
    const firebaseConfig = {
      apiKey: "AIzaSyA1PxEOrwjVi4BOLA13UbFIncTYe6RdYIQ",
      authDomain: "dear-miracle.firebaseapp.com",
      projectId: "dear-miracle",
      storageBucket: "dear-miracle.firebasestorage.app",
      messagingSenderId: "793139917614",
      appId: "1:793139917614:web:dec74f65af6a0df1c740bf",
      measurementId: "G-VF22L8ZR6D"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const $ = (id)=>document.getElementById(id);

    // ===== �됰꽕�� =====
    const NICK_KEY = "dm_nick";
    function getNick(){ return (localStorage.getItem(NICK_KEY) || "").trim(); }
    function setNick(n){ localStorage.setItem(NICK_KEY, (n||"").trim()); }

    function fmtTime(ts){
      if(!ts) return "";
      try{
        const d = ts.toDate ? ts.toDate() : new Date(ts);
        const yy = String(d.getFullYear()).slice(2);
        const mm = String(d.getMonth()+1).padStart(2,"0");
        const dd = String(d.getDate()).padStart(2,"0");
        const hh = String(d.getHours()).padStart(2,"0");
        const mi = String(d.getMinutes()).padStart(2,"0");
        return `${yy}.${mm}.${dd} ${hh}:${mi}`;
      }catch{
        return "";
      }
    }

    // ===== UI =====
    const dmFabBtn = $("dmFabBtn");
    const dmBadge  = $("dmBadge");

    const dmBg = $("dmBg");
    const dmCloseBtn = $("dmCloseBtn");
    const dmRefresh = $("dmRefresh");
    const dmNickBtn = $("dmNickBtn");
    const dmHint = $("dmHint");

    const roomList = $("roomList");
    const roomHint = $("roomHint");

    const chatWith = $("chatWith");
    const chatHintTop = $("chatHintTop");
    const chatList = $("chatList");
    const chatInput = $("chatInput");
    const chatSend = $("chatSend");
    const chatBackBtn = $("chatBackBtn");

    // �� 紐⑤떖
    const nickBg = $("nickBg");
    const nickClose = $("nickClose");
    const nickInput = $("nickInput");
    const nickCancel = $("nickCancel");
    const nickSave = $("nickSave");
    const nickHint = $("nickHint");

    let currentPeer = "";
    let unsubRoomsA = null;
    let unsubRoomsB = null;
    let unsubChatA = null;
    let unsubChatB = null;
    let unsubBadge = null;

    function stopRooms(){
      if(unsubRoomsA) unsubRoomsA();
      if(unsubRoomsB) unsubRoomsB();
      unsubRoomsA = unsubRoomsB = null;
    }
    function stopChat(){
      if(unsubChatA) unsubChatA();
      if(unsubChatB) unsubChatB();
      unsubChatA = unsubChatB = null;
    }
    function stopBadge(){
      if(unsubBadge) unsubBadge();
      unsubBadge = null;
    }

    function showHint(s){ dmHint.textContent = s || ""; }

    function openNickModal(force=false){
      nickHint.textContent = "";
      nickInput.value = getNick();
      nickBg.style.display = "flex";
      nickClose.style.display = force ? "none" : "block";
      setTimeout(()=> nickInput.focus(), 30);
    }
    function closeNickModal(){
      nickBg.style.display = "none";
    }
    function ensureNick(){
      const n = getNick();
      if(!n){
        openNickModal(true);
        return false;
      }
      return true;
    }

    nickSave.addEventListener("click", ()=>{
      const val = (nickInput.value || "").trim();
      if(!val){
        nickHint.textContent = "�됰꽕�꾩쓣 �낅젰�댁＜�몄슂.";
        return;
      }
      setNick(val);
      closeNickModal();
      startBadge(); // �� �ㅼ젙 �� 諭껋� �쒖옉
    });
    nickCancel.addEventListener("click", ()=>{
      if(getNick()) closeNickModal();
      else nickHint.textContent = "�됰꽕�꾩쓣 �낅젰�댁빞 吏꾪뻾�� �� �덉뒿�덈떎.";
    });
    nickClose.addEventListener("click", closeNickModal);
    nickBg.addEventListener("click", (e)=>{ if(e.target===nickBg && getNick()) closeNickModal(); });

    // ===== �덉씫�� 諭껋�(吏꾩쭨 read=false) =====
    function updateBadge(n){
      const num = Math.max(0, Number(n)||0);
      dmBadge.textContent = num > 99 ? "99+" : String(num);
      dmBadge.style.display = num > 0 ? "inline-flex" : "none";
    }

    function startBadge(){
      stopBadge();
      const me = getNick();
      if(!me){ updateBadge(0); return; }

      const qy = query(
        collection(db, "messages"),
        where("to", "==", me),
        where("read", "==", false)
      );

      unsubBadge = onSnapshot(qy, (snap)=>{
        updateBadge(snap.size);
      });
    }

    // ===== 紐⑤떖 �닿린/�リ린 =====
    function openDM(){
      if(!ensureNick()) return;
      dmBg.style.display = "flex";
      showHint("");
      showRooms();
      startRooms();
    }
    function closeDM(){
      dmBg.style.display = "none";
      showHint("");
      stopRooms();
      stopChat();
    }

    dmFabBtn.addEventListener("click", openDM);
    dmCloseBtn.addEventListener("click", closeDM);
    dmBg.addEventListener("click", (e)=>{ if(e.target===dmBg) closeDM(); });
    dmNickBtn.addEventListener("click", ()=> openNickModal(false));
    dmRefresh.addEventListener("click", ()=>{
      if(!ensureNick()) return;
      if(currentPeer){
        stopChat();
        startChat(currentPeer);
      }else{
        stopRooms();
        startRooms();
      }
    });

    function showRooms(){
      currentPeer = "";
      chatBackBtn.style.display = "none";
      chatWith.textContent = "���붾� �좏깮�섏꽭��";
      chatHintTop.textContent = "";
      chatList.innerHTML = "";
      chatInput.value = "";
      roomHint.textContent = "";
    }

    function showChat(peer){
      currentPeer = peer;
      chatBackBtn.style.display = "inline-flex";
      chatWith.textContent = `�곷�: ${peer}`;
      chatHintTop.textContent = "";
      chatList.innerHTML = "";
      chatInput.value = "";
    }

    chatBackBtn.addEventListener("click", ()=>{
      stopChat();
      showRooms();
      startRooms();
    });

    // ===== ���붾갑 紐⑸줉 �ㅼ떆媛�(諛쏆�+蹂대궦 �⑹퀜�� 諛� 留뚮뱾湲�) =====
    function renderRoomsFromMixed(all, me){
      roomList.innerHTML = "";
      if(all.length === 0){
        roomHint.textContent = "履쎌�媛� �놁뒿�덈떎.";
        return;
      }

      // 理쒖떊�� �뺣젹
      all.sort((a,b)=>{
        const at = a.createdAt?.toMillis ? a.createdAt.toMillis() : 0;
        const bt = b.createdAt?.toMillis ? b.createdAt.toMillis() : 0;
        return bt - at;
      });

      // �곷�諛� 湲곗� 諛� 臾띔린 + �덉씫��(�곷�->�� read=false) 移댁슫��
      const rooms = new Map();
      const unreadCnt = new Map();

      for(const m of all){
        const peer = (m.from === me) ? (m.to || "") : (m.from || "");
        if(!peer) continue;

        // 理쒖떊 硫붿떆吏� 1媛�
        if(!rooms.has(peer)) rooms.set(peer, m);

        // �덉씫�� 移댁슫��(�곷�媛� 蹂대궦 寃� 以� read=false留�)
        if(m.to === me && m.from === peer && m.read === false){
          unreadCnt.set(peer, (unreadCnt.get(peer)||0) + 1);
        }
      }

      const frag = document.createDocumentFragment();
      for(const [peer, lastMsg] of rooms.entries()){
        const div = document.createElement("div");
        div.className = "room";
        div.onclick = ()=>{
          stopRooms();
          showChat(peer);
          startChat(peer);
        };

        const left = document.createElement("div");
        left.style.minWidth = "0";

        const name = document.createElement("div");
        name.className = "name";
        name.textContent = peer;

        const last = document.createElement("div");
        last.className = "last";
        last.textContent = lastMsg.body || "";

        left.appendChild(name);
        left.appendChild(last);

        const right = document.createElement("div");
        right.className = "right";

        const time = document.createElement("div");
        time.className = "time";
        time.textContent = fmtTime(lastMsg.createdAt);

        const badge = document.createElement("div");
        badge.className = "unread";
        const n = unreadCnt.get(peer) || 0;
        badge.textContent = n > 99 ? "99+" : String(n);
        badge.style.display = n > 0 ? "inline-flex" : "none";

        right.appendChild(time);
        right.appendChild(badge);

        div.appendChild(left);
        div.appendChild(right);
        frag.appendChild(div);
      }

      roomList.appendChild(frag);
      roomHint.textContent = "";
    }

    function startRooms(){
      if(!ensureNick()) return;
      const me = getNick();
      roomHint.textContent = "遺덈윭�ㅻ뒗 以묅��";
      roomList.innerHTML = "";

      stopRooms();

      const recvQ = query(
        collection(db, "messages"),
        where("to", "==", me),
        orderBy("createdAt", "desc"),
        limit(80)
      );
      const sentQ = query(
        collection(db, "messages"),
        where("from", "==", me),
        orderBy("createdAt", "desc"),
        limit(80)
      );

      let recvArr = [];
      let sentArr = [];

      unsubRoomsA = onSnapshot(recvQ, (snap)=>{
        recvArr = [];
        snap.forEach(d => recvArr.push({ id:d.id, ...d.data() }));
        renderRoomsFromMixed([...recvArr, ...sentArr], me);
      });

      unsubRoomsB = onSnapshot(sentQ, (snap)=>{
        sentArr = [];
        snap.forEach(d => sentArr.push({ id:d.id, ...d.data() }));
        renderRoomsFromMixed([...recvArr, ...sentArr], me);
      });
    }

    // ===== �쎌쓬 泥섎━: �닿� ���붿갹 �대㈃ �곷�->�� read=false 瑜� read=true濡� =====
    async function markRead(peer){
      const me = getNick();
      const qy = query(
        collection(db, "messages"),
        where("from", "==", peer),
        where("to", "==", me),
        where("read", "==", false),
        limit(80)
      );
      const snap = await getDocs(qy);
      const jobs = [];
      snap.forEach(d=>{
        jobs.push(updateDoc(doc(db, "messages", d.id), { read:true }));
      });
      if(jobs.length) await Promise.all(jobs);
    }

    // ===== ���� �ㅼ떆媛�(�묒そ 荑쇰━ �⑹퀜�� �뚮뜑) =====
    function startChat(peer){
      if(!ensureNick()) return;
      const me = getNick();

      stopChat();
      chatHintTop.textContent = "遺덈윭�ㅻ뒗 以묅��";
      chatList.innerHTML = "";

      const aQ = query(
        collection(db, "messages"),
        where("from", "==", me),
        where("to", "==", peer),
        orderBy("createdAt", "desc"),
        limit(120)
      );
      const bQ = query(
        collection(db, "messages"),
        where("from", "==", peer),
        where("to", "==", me),
        orderBy("createdAt", "desc"),
        limit(120)
      );

      let aArr = [];
      let bArr = [];

      function render(){
        const all = [...aArr, ...bArr];
        if(all.length === 0){
          chatHintTop.textContent = "���붽� �놁뒿�덈떎.";
          chatList.innerHTML = "";
          return;
        }

        all.sort((x,y)=>{
          const xt = x.createdAt?.toMillis ? x.createdAt.toMillis() : 0;
          const yt = y.createdAt?.toMillis ? y.createdAt.toMillis() : 0;
          return xt - yt;
        });

        chatList.innerHTML = "";
        const frag = document.createDocumentFragment();

        for(const m of all){
          const row = document.createElement("div");
          row.className = "chat-row";

          const bubble = document.createElement("div");
          bubble.className = "bubble" + (m.from === me ? " me" : "");
          bubble.textContent = m.body || "";

          const t = document.createElement("div");
          t.className = "t";
          t.textContent = `${m.from === me ? "��" : (m.from || "-")} 쨌 ${fmtTime(m.createdAt)}`;

          bubble.appendChild(t);
          row.appendChild(bubble);
          frag.appendChild(row);
        }

        chatList.appendChild(frag);
        chatHintTop.textContent = "";
        setTimeout(()=>{ chatList.scrollTop = chatList.scrollHeight; }, 0);
      }

      unsubChatA = onSnapshot(aQ, (snap)=>{
        aArr = [];
        snap.forEach(d => aArr.push({ id:d.id, ...d.data() }));
        render();
      });

      unsubChatB = onSnapshot(bQ, async (snap)=>{
        bArr = [];
        snap.forEach(d => bArr.push({ id:d.id, ...d.data() }));
        render();

        // �곷�媛� 蹂대궦 嫄� �쎌쓬 泥섎━
        try{ await markRead(peer); }catch(e){}
      });
    }

    // ===== 蹂대궡湲� =====
    chatSend.addEventListener("click", async ()=>{
      if(!ensureNick()) return;
      const me = getNick();
      const peer = currentPeer;
      const body = (chatInput.value || "").trim();

      if(!peer){ showHint("���� �곷�瑜� 癒쇱� �좏깮�댁＜�몄슂."); return; }
      if(!body){ showHint("�댁슜�� �낅젰�댁＜�몄슂."); return; }
      if(peer === me){ showHint("�먭린 �먯떊�먭쾶�� 蹂대궪 �� �놁뒿�덈떎."); return; }

      try{
        chatSend.disabled = true;
        showHint("�꾩넚 以묅��");

        await addDoc(collection(db, "messages"), {
          from: me,
          to: peer,
          body,
          postId: "",
          read: false,
          createdAt: serverTimestamp()
        });

        chatInput.value = "";
        showHint("");
      }catch(err){
        console.error(err);
        showHint("�꾩넚�� �ㅽ뙣�덉뒿�덈떎.");
      }finally{
        chatSend.disabled = false;
      }
    });

    // �뷀꽣濡� 蹂대궡湲�(Shift+Enter�� 以꾨컮轅�)
    chatInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        chatSend.click();
      }
    });

    // ===== 珥덇린 援щ룞 =====
    // �� �덉쑝硫� 諭껋� �ㅼ떆媛� �쒖옉
    if(getNick()) startBadge();
  
/* ---- Mobile window layout polish (random overlap + bring key buttons forward) ---- */
  (function applyMobileLayoutOnce() {
    const isMobile = window.matchMedia('(max-width: 768px)').matches;
    if (!isMobile) return;

    const wins = Array.from(document.querySelectorAll('.win[data-key]'));
    if (!wins.length) return;

    // Deterministic-but-varied random (so it doesn't jump around on every reload)
    // Seed from viewport + day.
    const seedStr = String(window.innerWidth) + 'x' + String(window.innerHeight) + '|' + new Date().toDateString();
    let seed = 0;
    for (let i = 0; i < seedStr.length; i++) seed = (seed * 31 + seedStr.charCodeAt(i)) >>> 0;
    const rand = () => {
      // xorshift32
      seed ^= seed << 13; seed >>>= 0;
      seed ^= seed >> 17; seed >>>= 0;
      seed ^= seed << 5;  seed >>>= 0;
      return (seed >>> 0) / 4294967296;
    };

    const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));

    // Make sure important windows are visible + in front
    const keyOrder = ['notice', 'dm-notice']; // notice = board shortcut, dm-notice = contact/DM shortcut

    // Base sizing (mobile)
    const sizeByKey = {
      'notice':     { w: 86, top: 6,  left: 6,  z: 120 },
      'dm-notice':  { w: 74, top: 16, left: 12, z: 119 },
    };

    // Default size for media windows
    const defaultMediaW = 78; // vw

    // Place key windows first (slightly overlapped, but readable)
    const keyPlaced = new Set();
    wins.forEach(win => {
      const key = win.dataset.key || '';
      if (!keyOrder.includes(key)) return;

      const cfg = sizeByKey[key];
      if (!cfg) return;

      win.style.width = cfg.w + 'vw';
      win.style.left  = cfg.left + 'vw';
      win.style.top   = cfg.top + 'vh';
      win.style.zIndex = String(cfg.z);
      win.style.transform = 'scale(0.96)';
      win.style.transformOrigin = 'top left';
      keyPlaced.add(key);
    });

    // Place the rest with "desktop-like" scattered overlap (but keep on screen)
    // We bias them to the right / lower area so they don't cover the shortcut windows too much.
    let i = 0;
    wins.forEach(win => {
      const key = win.dataset.key || '';
      if (keyPlaced.has(key)) return;

      // Width: slightly smaller than full screen
      const w = clamp(defaultMediaW - (rand() * 10), 62, 82); // vw
      const left = clamp(18 + rand() * 22 + (i % 2) * 4, 4, 30); // vw
      const top  = clamp(28 + rand() * 42 + (i % 3) * 3, 18, 78); // vh

      const z = 60 + i; // keep behind shortcuts

      win.style.width = w + 'vw';
      win.style.left = left + 'vw';
      win.style.top  = top + 'vh';
      win.style.zIndex = String(z);
      win.style.transform = 'scale(0.94)';
      win.style.transformOrigin = 'top left';

      i += 1;
    });

    // Prevent accidental overflow scroll caused by large absolute windows
    document.body.style.overflowX = 'hidden';
  })();
  /* ---- end mobile layout polish ---- */
;
</script>

<script>
(function(){
  function qs(sel){ return document.querySelector(sel); }
  const media = qs("video, audio");
  const btn = qs("#muteBtn");

  if(!media || !btn) return;

  function updateUI(){
    if(media.muted || media.volume === 0){
      btn.innerHTML = "�뵁 �뚯냼嫄� �댁젣";
      btn.setAttribute("aria-pressed","true");
    }else{
      btn.innerHTML = "�뵄 �뚯냼嫄�";
      btn.setAttribute("aria-pressed","false");
    }
  }

  btn.addEventListener("click", function(){
    // Desktop browsers sometimes block audio until user interaction:
    // this click counts as interaction.
    if(media.muted || media.volume === 0){
      media.muted = false;
      media.volume = 1.0;
      media.play().catch(()=>{});
    }else{
      media.muted = true;
    }
    updateUI();
  });

  // Init state
  updateUI();
})();
</script>


<script>
/* === Mobile auto-layout PATCH (safe) === */
(function(){
  const isMobile = window.matchMedia("(max-width: 560px)").matches;
  if(!isMobile) return;

  const PROTECT = ["notice","contact","guide","links"];

  function placeOnce(win){
    if(win.dataset.placed) return;
    const maxX = Math.max(8, window.innerWidth - win.offsetWidth - 8);
    const maxY = Math.max(8, window.innerHeight - win.offsetHeight - 8);
    win.style.left = Math.floor(Math.random()*maxX) + "px";
    win.style.top  = Math.floor(Math.random()*maxY) + "px";
    win.dataset.placed = "1";
  }

  document.querySelectorAll(".win").forEach(win=>{
    const key = win.dataset.key || "";
    placeOnce(win);

    if(PROTECT.includes(key)){
      win.style.width = "";
      win.style.maxWidth = "";
      win.style.transform = "";
    }
  });
})();
</script>


<!-- floating stickers (background only) -->
<div class="floating-stickers">
  <img src="assets/stickers/video-tape.png" class="sticker vhs" alt="">
  <img src="assets/stickers/headphone.png" class="sticker headphone" alt="">
  <img src="assets/stickers/camera.png" class="sticker camera" alt="">
</div>


<!-- schedule ticket sticker (background only) -->
<div class="schedule-ticket" aria-hidden="true">
  <div class="ticket-line w">January 15, 2026 (Thu)</div>
  <div class="ticket-line w">08:00 PM �� Registration</div>
  <div class="ticket-line w">10:00 PM �� Intro</div>

  <div class="ticket-gap"></div>

  <div class="ticket-line b">January 16 �� January 19</div>
  <div class="ticket-line b">Quiet days in between</div>
  <div class="ticket-line b">Winter nights, ongoing</div>

  <div class="ticket-gap"></div>

  <div class="ticket-line w">January 20, 2026 (Tue)</div>
  <div class="ticket-line w">09:00 PM �� Outro &amp; Close</div>
</div>

</body>
</html>
